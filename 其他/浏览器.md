### 浏览器的进程和线程
**进程是资源分配的最小单位，线程是CPU调度的最小单位**
区别
- 进程可以看作独立应用，线程不能
- 资源：进程是cpu资源分配的最小单位；线程是cpu调度的最小单位（一个进程可以有多个线程）
- 通信：线程间可以通过直接共享同一进程中的资源。而进程通信需用借助进程间通信
- 调度：进程切换比线程切换的开销要打。线程是CPU调度的基本单位，线程的切换不会引起进程的切换，单某个进程中的线程切换到另一个进程中的线程时，会引起进程切换
- 系统开销：由于创建和撤销进程时，系统都要为之分配或回收资源，如内存、I/O等，其开销远大于创建或撤销线程
  
四大特点
1. 进程中的任一线程执行出错，都会导你整个进程的崩溃
2. 线程之间共享进程的数据
3. 当一个进程关闭之后，操作系统会回收进程所占用的内存
4. 进程之间内容相互隔离：一个进程奔溃或者挂起了，不会影响到其他进程的。如果进程之间需要进行数据的通信，这时候就需要使用进程间通信机制

> 浏览器主要有5个进程
 - 1个**浏览器主进程**： 主要负责界面显示、用户交互、子进程管理，同时提供存储等功能
 - 多个**渲染进程**：核心任务是将HTML、CSS和JS转换成用户可以与之交互的网页。排版引擎Blink的JavaScript V8引擎都是在该进程中，默认情况下，Chrome会为每个tab标签创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱环境
 - 1个**GPU进程**：其实，GPU的使用初衷是为了实现3d css的效果，只是随后网页、Chrom的UI界面都选择采用了GPU来绘制，这使得GPU成为浏览器普遍需求。最后，Chrom在其多进程架构上也引入了GPU进程
 - 1个**网络进程**：主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立出来，成为一个单独的进程
 - 多个**插件进程**：主要负责插件的运行
  
 打开一个网页，最少需要四个进程：浏览器主进程、渲染进程、GPU进程、网络进程
 虽然多进程提升了浏览器的稳定性、流畅性、安全性，但是同样不可避免的带来一些问题： 
 - 更高的资源占用：因为每个进程都会包含公共基础结构的副本（如JavaScript运行环境），这就意味着浏览器会消耗更多内存资源
 - 更复杂的架构体系：浏览器各模块之间耦合性高、扩展性差等问题，会导致现在的架构已经很难适应新的需求
  

### 浏览器渲染进程的线程
浏览器的渲染进程的线程总共有五种
1. GUI渲染线程
   负责渲染浏览器页面，解析HTML、css，构建dom树、构建渲染树和绘制页面；当界面需要重绘或者由于某种操作引发回流时，该线程就会执行
   注意：GUI渲染线程和JS引擎线程时互斥的，当JS引擎执行时GUI线程会被挂起，GUI更新会被保存在一个队列中等到JS引擎空闲时立即被执行
2. JS引擎线程
   js引擎一直等待着任务队列中任务的到来，然后加以处理，一个tab页面中什么时候都只有一个js引擎在运行js程序
   注意：GUI渲染线程和JS引擎线程时互斥关系，如果js执行时间过长，会造成渲染不连贯，页面渲染加载阻塞
3. 事件触发线程
4. 定时器触发线程
5. 异步http请求线程

### 如何实现浏览器内多个标签页面之间的通信
1. 使用websocket协议，因为websocket协议可以实现服务器推送。标签页面向服务器发送数据，然后服务器向其他标签页推送转发
2. localStorage
3. window.postMessage